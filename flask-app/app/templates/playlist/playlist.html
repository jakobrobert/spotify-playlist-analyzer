<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">

    <title>Spotify Playlist Analyzer - Playlist - {{ playlist.name }}</title>
</head>
<body>
    <div class="container">
        <h1>Playlist: {{ playlist.name }}</h1>
        <br>

        <h2>Summary</h2>
        {% include "playlist/playlist_summary.html" %}
        <br>

        <h2>Attribute Distribution</h2>
        {% include "playlist/playlist_attribute_distribution_option.html" %}
        <br>

        <h2>Sort Tracks</h2>
        <!-- TODONOW extract sub template -->
        <form action="{{ url_for('playlist_view.get_playlist_by_id', playlist_id=playlist.id) }}" method="GET">
            <select class="form-control" name="sort_by">
                {% for attribute in valid_attributes_for_sort_option %}
                    <option value="{{ attribute }}" {% if sort_by == attribute %} selected {% endif %}>
                        {{ attribute_display_names[attribute] }}
                    </option>
                {% endfor %}
            </select>
            <select class="form-control" name="order">
                <option value="ascending" {% if order == "ascending" %} selected {% endif %}>
                    Ascending
                </option>
                <option value="descending" {% if order == "descending" %} selected {% endif %}>
                    Descending
                </option>
            </select>
            <button class="btn btn-secondary" type="submit">Sort</button>
        </form>
        <br>

        <h2>Filter Tracks</h2>
        <!-- TODONOW extract sub template -->
        <form action="{{ url_for('playlist_view.get_playlist_by_id', playlist_id=playlist.id) }}" method="GET">
            <div>
                <input type="radio" id="artists" name="filter_by" value="artists"
                       {% if filter_by == "artists" %} checked {% endif %}>
                <label for="artists">Artists</label>
                <label for="artists_substring">contain</label>
                <input type="text" id="artists_substring" name="artists_substring" value="{{ artists_substring }}">
            </div>
            <div>
                <input type="radio" id="title" name="filter_by" value="title"
                       {% if filter_by == "title" %} checked {% endif %}>
                <label for="title">Title</label>
                <label for="title_substring">contains</label>
                <input type="text" id="title_substring" name="title_substring" value="{{ title_substring }}">
            </div>
            <div>
                <input type="radio" id="release_year" name="filter_by" value="release_year"
                       {% if filter_by == "release_year" %} checked {% endif %}>
                <label for="release_year">Release Year</label>
                <label for="min_release_year">from</label>
                <input type="number" id="min_release_year" name="min_release_year" value="{{ min_release_year }}">
                <label for="max_release_year">to</label>
                <input type="number" id="max_release_year" name="max_release_year" value="{{ max_release_year }}">
            </div>
            <div>
                <input type="radio" id="tempo" name="filter_by" value="tempo"
                       {% if filter_by == "tempo" %} checked {% endif %}>
                <label for="tempo">Tempo (BPM)</label>
                <label for="min_tempo">from</label>
                <input type="number" id="min_tempo" name="min_tempo" value="{{ min_tempo }}">
                <label for="max_tempo">to</label>
                <input type="number" id="max_tempo" name="max_tempo" value="{{ max_tempo }}">
            </div>
            <div>
                <input type="radio" id="key" name="filter_by" value="key"
                       {% if filter_by == "key" %} checked {% endif %}>
                <label for="key">Key</label>
                <label for="expected_key">is</label>
                <select class="form-control" id="expected_key" name="expected_key">
                    {% for key in valid_keys %}
                        <option value="{{ key }}" {% if expected_key == key %} selected {% endif %}>
                            {{ key }}
                        </option>
                    {% endfor %}
                </select>
            </div>
            <div>
                <input type="radio" id="mode" name="filter_by" value="mode"
                       {% if filter_by == "mode" %} checked {% endif %}>
                <label for="mode">Mode</label>
                <label for="expected_mode">is</label>
                <select class="form-control" id="expected_mode" name="expected_mode">
                    {% for mode in valid_modes %}
                        <option value="{{ mode }}" {% if expected_mode == mode %} selected {% endif %}>
                            {{ mode }}
                        </option>
                    {% endfor %}
                </select>
            </div>
            <div>
                <input type="radio" id="key_signature" name="filter_by" value="key_signature"
                       {% if filter_by == "key_signature" %} checked {% endif %}>
                <label for="key_signature">Key Signature</label>
                <label for="expected_key_signature">is</label>
                <select class="form-control" id="expected_key_signature" name="expected_key_signature">
                    {% for key_signature in valid_key_signatures %}
                        <option value="{{ key_signature }}" {% if expected_key_signature == key_signature %} selected {% endif %}>
                            {{ key_signature }}
                        </option>
                    {% endfor %}
                </select>
            </div>
            <div>
                <input type="radio" id="genres" name="filter_by" value="genres"
                       {% if filter_by == "genres" %} checked {% endif %}>
                <label for="genres">Genres</label>
                <label for="genres_substring">contain</label>
                <input type="text" id="genres_substring" name="genres_substring" value="{{ genres_substring }}">
            </div>
            <button class="btn btn-secondary" type="submit">Filter</button>
        </form>
        <br>

        <h2>Export Playlist</h2>
        <!-- TODONOW extract sub template -->

        <!-- Form with hidden input element so track ids can be sent to POST endpoint.
        Would be cleaner with JavaScript, but was struggling once with adding JavaScript files in this project,
        Don't want to waste time with that now -->
        <form action="{{ url_for('export_playlist_view.export_playlist') }}" method="POST">
            <div>
                <label for="playlist_name">Playlist Name:</label>
                <input type="text" id="playlist_name" name="playlist_name" required>
            </div>
            {% for track in playlist.tracks %}
                <input type="hidden" name="track_ids[]" value="{{ track.id }}">
            {% endfor %}
            <button class="btn btn-secondary" type="submit">Export</button>
        </form>
        <br>

        <h2>Tracks Table</h2>
        <!-- Wanted to use "with", but led to TemplateSyntaxError, maybe the used Jinja2 version does not support it -->
        {% set tracks = playlist.tracks %}
        {% include "components/tracks_table.html" %}
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
            crossorigin="anonymous">
    </script>
</body>
</html>
